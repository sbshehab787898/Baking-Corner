<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Baking Corner — Dashboard</title>
    <link rel="stylesheet" href="../assets/style.css" />
    <link rel="stylesheet" href="admin-style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;900&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../assets/supabase-client.js"></script>
    <style>
        /* ── Dashboard-only premium overrides ── */
        .dash-stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .dash-stat-card {
            background: #fff;
            border-radius: 2rem;
            padding: 1.75rem 2rem;
            box-shadow: 0 4px 24px rgba(45, 30, 23, 0.07);
            border: 1.5px solid #f5f0f0;
            position: relative;
            overflow: hidden;
            transition: transform 0.35s cubic-bezier(.4, 0, .2, 1), box-shadow 0.35s;
        }

        .dash-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 2rem 2rem 0 0;
        }

        .dash-stat-card.green::before {
            background: linear-gradient(90deg, #4ade80, #22c55e);
        }

        .dash-stat-card.pink::before {
            background: linear-gradient(90deg, #FDB9C8, #F896AC);
        }

        .dash-stat-card.blue::before {
            background: linear-gradient(90deg, #60a5fa, #3b82f6);
        }

        .dash-stat-card.gold::before {
            background: linear-gradient(90deg, #D4AF37, #f59e0b);
        }

        .dash-stat-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 50px rgba(45, 30, 23, 0.12);
        }

        .dash-stat-icon {
            width: 46px;
            height: 46px;
            border-radius: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1.1rem;
        }

        .dash-stat-card.green .dash-stat-icon {
            background: rgba(74, 222, 128, 0.12);
        }

        .dash-stat-card.pink .dash-stat-icon {
            background: rgba(253, 185, 200, 0.18);
        }

        .dash-stat-card.blue .dash-stat-icon {
            background: rgba(96, 165, 250, 0.12);
        }

        .dash-stat-card.gold .dash-stat-icon {
            background: rgba(212, 175, 55, 0.14);
        }

        .dash-stat-label {
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.38em;
            color: #bbb;
            margin-bottom: 0.35rem;
        }

        .dash-stat-value {
            font-family: 'Outfit', sans-serif;
            font-size: 2rem;
            font-weight: 800;
            color: #1a1a1a;
            line-height: 1;
            margin-bottom: 0.4rem;
        }

        .dash-stat-sub {
            font-size: 11px;
            font-weight: 700;
        }

        .dash-stat-sub.up {
            color: #22c55e;
        }

        .dash-stat-sub.neutral {
            color: #D4AF37;
        }

        /* ── Recent Orders card ── */
        .dash-section-card {
            background: #fff;
            border-radius: 2rem;
            padding: 2rem 2.2rem;
            box-shadow: 0 4px 24px rgba(45, 30, 23, 0.06);
            border: 1.5px solid #f5f0f0;
            margin-bottom: 2rem;
        }

        .dash-section-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .dash-section-title {
            font-family: 'Outfit', sans-serif;
            font-size: 1.15rem;
            font-weight: 800;
            color: #1a1a1a;
        }

        .dash-view-all {
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            color: #F896AC;
            text-decoration: none;
            padding: 0.45rem 1rem;
            border-radius: 9999px;
            background: rgba(248, 150, 172, 0.08);
            transition: background 0.3s, color 0.3s;
        }

        .dash-view-all:hover {
            background: #F896AC;
            color: #fff;
        }

        /* ── Quick-link cards ── */
        .quick-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .quick-card {
            background: #fff;
            border-radius: 2rem;
            padding: 2rem 2rem 1.8rem;
            box-shadow: 0 4px 20px rgba(45, 30, 23, 0.06);
            border: 1.5px solid #f5f0f0;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            position: relative;
            overflow: hidden;
            transition: transform 0.35s cubic-bezier(.4, 0, .2, 1), box-shadow 0.35s;
        }

        .quick-card::after {
            content: '→';
            position: absolute;
            top: 1.6rem;
            right: 1.8rem;
            font-size: 1.1rem;
            color: #ddd;
            transition: color 0.3s, transform 0.3s;
        }

        .quick-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 48px rgba(45, 30, 23, 0.12);
        }

        .quick-card:hover::after {
            color: #F896AC;
            transform: translateX(4px);
        }

        .quick-icon {
            font-size: 2rem;
            line-height: 1;
            margin-bottom: 0.3rem;
        }

        .quick-title {
            font-family: 'Outfit', sans-serif;
            font-size: 1.05rem;
            font-weight: 800;
            color: #1a1a1a;
        }

        .quick-desc {
            font-size: 0.78rem;
            color: #9E8E87;
            font-style: italic;
        }

        @media (max-width: 640px) {
            .dash-stat-grid {
                grid-template-columns: 1fr 1fr;
            }

            .quick-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 400px) {
            .quick-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body class="admin-body">

    <div id="preloader">
        <img src="../assets/logo.jpeg" alt="Logo" class="loader-logo">
        <div class="loader-bar">
            <div class="loader-progress"></div>
        </div>
    </div>

    <div id="adminSidebarMount"></div>

    <main class="admin-main">

        <!-- Page Header -->
        <div class="admin-page-header fade-in">
            <span class="admin-page-overline">Overview</span>
            <h1 class="admin-page-title">Dashboard</h1>
        </div>

        <!-- Stat Cards -->
        <div class="dash-stat-grid fade-in">

            <!-- Total Sales -->
            <div class="dash-stat-card green">
                <div class="dash-stat-icon">💰</div>
                <p class="dash-stat-label">Total Sales</p>
                <p class="dash-stat-value" id="dashTotalSales">৳0</p>
                <p class="dash-stat-sub up" id="dashSalesChange">+0% this month</p>
            </div>

            <!-- Categories -->
            <div class="dash-stat-card pink">
                <div class="dash-stat-icon">🗂️</div>
                <p class="dash-stat-label">Categories</p>
                <p class="dash-stat-value" id="dashCornerCount">—</p>
                <p class="dash-stat-sub neutral">Active sections</p>
            </div>

            <!-- Products -->
            <div class="dash-stat-card blue">
                <div class="dash-stat-icon">🛍️</div>
                <p class="dash-stat-label">Products</p>
                <p class="dash-stat-value" id="dashProductCount">—</p>
                <p class="dash-stat-sub neutral">Total items</p>
            </div>

            <!-- Store Status -->
            <div class="dash-stat-card gold">
                <div class="dash-stat-icon">✨</div>
                <p class="dash-stat-label">Store Status</p>
                <p class="dash-stat-value">Active</p>
                <p class="dash-stat-sub neutral">Growth Mode</p>
            </div>

        </div>

        <!-- Recent Orders -->
        <div class="dash-section-card fade-in">
            <div class="dash-section-head">
                <span class="dash-section-title">🧾 Recent Orders</span>
                <a href="admin-orders.html" class="dash-view-all">View All →</a>
            </div>
            <div style="overflow-x:auto">
                <table class="activity-table">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentOrdersBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Quick Links -->
        <div class="quick-grid fade-in">
            <a href="admin-corners.html" class="quick-card">
                <div class="quick-icon">🗂️</div>
                <div class="quick-title">Manage Categories</div>
                <div class="quick-desc">Organize your shop sections</div>
            </a>
            <a href="admin-products.html" class="quick-card">
                <div class="quick-icon">🛍️</div>
                <div class="quick-title">Manage Products</div>
                <div class="quick-desc">Add or update items in your shop</div>
            </a>
            <a href="admin-orders.html" class="quick-card">
                <div class="quick-icon">📋</div>
                <div class="quick-title">View Orders</div>
                <div class="quick-desc">Track and manage customer orders</div>
            </a>
            <a href="admin-settings.html" class="quick-card">
                <div class="quick-icon">⚙️</div>
                <div class="quick-title">Settings</div>
                <div class="quick-desc">Configure store preferences</div>
            </a>
        </div>

    </main>

    <script src="admin-shared.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            adminAuthGuard();
            renderAdminSidebar('dashboard');
            await syncAdminDataFromSupabase();
            const data = getAdminData();

            // Render Stats
            document.getElementById('dashCornerCount').textContent = data.corners.length;
            document.getElementById('dashProductCount').textContent = data.products.length;

            const total = data.orders.reduce((acc, o) => acc + (parseFloat(o.total) || 0), 0);
            const settings = JSON.parse(localStorage.getItem('siteSettings') || '{}');
            const sym = settings.currencySymbol || '৳';
            const pos = settings.currencyPosition || 'before';
            const fmt = n => pos === 'after' ? n.toLocaleString('en-IN') + sym : sym + n.toLocaleString('en-IN');

            document.getElementById('dashTotalSales').textContent = fmt(total);

            // Render Recent Orders (Last 5)
            const recent = data.orders.slice(0, 5);
            const body = document.getElementById('recentOrdersBody');
            if (recent.length === 0) {
                body.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:2rem;color:#aaa;font-style:italic">No orders yet.</td></tr>';
            } else {
                body.innerHTML = recent.map(o => `
                    <tr>
                        <td><strong>${o.customer?.name || 'Guest'}</strong></td>
                        <td>${o.items?.map(i => i.name).join(', ') || 'Custom Order'}</td>
                        <td style="font-weight:700;color:#F896AC">${fmt(parseFloat(o.total) || 0)}</td>
                        <td><span class="status-badge ${o.status?.toLowerCase() || 'pending'}">${o.status || 'Pending'}</span></td>
                    </tr>
                `).join('');
            }

            // Scroll animations
            const obs = new IntersectionObserver(entries => {
                entries.forEach(e => {
                    if (e.isIntersecting) {
                        e.target.classList.add('visible');
                        obs.unobserve(e.target);
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.fade-in').forEach(el => obs.observe(el));
        });
    </script>

</body>

</html>