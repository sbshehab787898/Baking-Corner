<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard — Baking Corner Admin</title>
    <link rel="stylesheet" href="../assets/style.css" />
    <link rel="stylesheet" href="admin-style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;900&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../assets/supabase-client.js"></script>
</head>

<body class="admin-body">

    <div id="adminSidebarMount"></div>

    <main class="admin-main">
        <div class="admin-page-header fade-in">
            <span class="admin-page-overline">Overview</span>
            <h1 class="admin-page-title">Dashboard</h1>
        </div>

        <!-- Stat Cards -->
        <div class="stat-grid fade-in">
            <div class="stat-card">
                <span class="stat-icon" style="color:#4ade80">📈</span>
                <p class="stat-label">Total Sales</p>
                <p class="stat-value" id="dashTotalSales">৳0</p>
                <p class="stat-change up" id="dashSalesChange">+0% this month</p>
            </div>
            <div class="stat-card" id="dashCornerCard">
                <span class="stat-icon" style="color:#FDB9C8">🏬</span>
                <p class="stat-label">Categories</p>
                <p class="stat-value" id="dashCornerCount">—</p>
                <p class="stat-change neutral">Active sections</p>
            </div>
            <div class="stat-card" id="dashProductCard">
                <span class="stat-icon" style="color:#60a5fa">📦</span>
                <p class="stat-label">Products</p>
                <p class="stat-value" id="dashProductCount">—</p>
                <p class="stat-change neutral">Total items</p>
            </div>
            <div class="stat-card">
                <span class="stat-icon" style="color:#D4AF37">✨</span>
                <p class="stat-label">Store Status</p>
                <p class="stat-value">Active</p>
                <p class="stat-change neutral">Growth Mode</p>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="admin-card fade-in" style="margin-bottom:2rem">
            <h2 class="admin-card-title">Recent Orders</h2>
            <div style="overflow-x:auto">
                <table class="activity-table">
                    <thead>
                        <tr>
                            <th>Customer</th>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentOrdersBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Quick Links -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem" class="fade-in">
            <a href="admin-corners.html" class="admin-card"
                style="text-decoration:none;color:inherit;display:block;transition:all 0.5s">
                <div style="font-size:2rem;margin-bottom:1rem">🏬</div>
                <h3 style="font-family:'Outfit',sans-serif;font-size:1.3rem;font-weight:700;margin-bottom:0.5rem">Manage
                    Categories</h3>
                <p style="font-size:0.8rem;color:#8E7D72">Organize your shop sections →</p>
            </a>
            <a href="admin-products.html" class="admin-card"
                style="text-decoration:none;color:inherit;display:block;transition:all 0.5s">
                <div style="font-size:2rem;margin-bottom:1rem">📦</div>
                <h3 style="font-family:'Outfit',sans-serif;font-size:1.3rem;font-weight:700;margin-bottom:0.5rem">Manage
                    Products</h3>
                <p style="font-size:0.8rem;color:#8E7D72">Add or update items in your shop →</p>
            </a>
        </div>
    </main>

    <script src="admin-shared.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            adminAuthGuard();
            renderAdminSidebar('dashboard');
            await syncAdminDataFromSupabase();
            const data = getAdminData();

            // Render Stats
            document.getElementById('dashCornerCount').textContent = data.corners.length;
            document.getElementById('dashProductCount').textContent = data.products.length;

            const total = data.orders.reduce((acc, o) => acc + (parseFloat(o.total) || 0), 0);
            const settings = JSON.parse(localStorage.getItem('siteSettings') || '{}');
            const sym = settings.currencySymbol || '৳';
            const pos = settings.currencyPosition || 'before';
            const fmt = n => pos === 'after' ? n.toLocaleString('en-IN') + sym : sym + n.toLocaleString('en-IN');

            document.getElementById('dashTotalSales').textContent = fmt(total);

            // Render Recent Orders (Last 5)
            const recent = data.orders.slice(0, 5);
            const body = document.getElementById('recentOrdersBody');
            if (recent.length === 0) {
                body.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:2rem;color:#aaa">No orders yet.</td></tr>';
            } else {
                body.innerHTML = recent.map(o => `
                    <tr>
                        <td><strong>${o.customer?.name || 'Guest'}</strong></td>
                        <td>${o.items?.map(i => i.name).join(', ') || 'Custom Order'}</td>
                        <td style="font-weight:700;color:#F896AC">${fmt(parseFloat(o.total) || 0)}</td>
                        <td><span class="status-badge ${o.status?.toLowerCase() || 'pending'}">${o.status || 'Pending'}</span></td>
                    </tr>
                `).join('');
            }

            // Animate cards on hover
            document.querySelectorAll('a.admin-card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-6px)';
                    card.style.boxShadow = '0 20px 50px rgba(45,30,23,0.1)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = '';
                    card.style.boxShadow = '';
                });
            });

            // Scroll animations
            const obs = new IntersectionObserver(entries => {
                entries.forEach(e => {
                    if (e.isIntersecting) {
                        e.target.classList.add('visible');
                        obs.unobserve(e.target);
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.fade-in').forEach(el => obs.observe(el));
        });
    </script>
</body>

</html>